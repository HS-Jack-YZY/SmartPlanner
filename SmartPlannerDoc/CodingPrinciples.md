# Cursor 代码编写原则

## 核心原则

### 1. 接口一致性
- 保持公共接口的稳定性
- 不随意改变方法签名
- 遵循语义版本控制
- 在必要的接口改变时提供过渡期
- 详细记录接口变更

### 2. 代码审查流程
- 修改代码前必须先浏览相关文件
- 理解代码的上下文和依赖关系
- 评估修改可能带来的影响
- 确保了解所有相关组件
- 记录代码审查的发现

### 3. 功能增加规范
- 新功能必须独立于现有功能
- 不得修改现有功能的行为
- 采用扩展而非修改的原则
- 确保向后兼容性
- 新功能必须有完整测试
- 优先在现有文件中扩展功能，避免创建新文件
- 仅在无法在现有文件中实现时才创建新文件

### 4. Bug 修复规范
- 精确定位 bug 范围
- 最小化修改范围
- 不影响其他功能
- 添加回归测试
- 记录修复过程

## 具体实践

### 代码审查清单
1. 浏览相关文件
   - 查看依赖关系
   - 理解业务逻辑
   - 确认影响范围
   - 检查单元测试

2. 接口修改检查
   - 验证兼容性
   - 检查调用方
   - 更新文档
   - 添加迁移说明

3. 新功能开发流程
   - 创建新的类或模块
   - 使用扩展方法
   - 避免修改现有代码
   - 编写独立测试

4. Bug 修复流程
   - 创建隔离测试
   - 确认修复范围
   - 验证其他功能
   - 添加防护措施

## 最佳实践

### 接口设计
- 遵循单一职责原则
- 使用清晰的命名
- 提供完整的文档
- 考虑扩展性

### 代码组织
- 模块化设计
- 清晰的目录结构
- 合理的文件分组
- 统一的编码风格

### 测试策略
- 单元测试覆盖
- 集成测试验证
- 回归测试保护
- 性能测试监控

### 文档维护
- 及时更新文档
- 记录重要决策
- 标注版本变更
- 提供使用示例

### 代码注释规范
- 文件注释
  - 每个文件顶部必须包含文件说明
  - 说明文件的主要功能和用途
  - 记录重要的修改历史
  - 标注作者和创建日期
  - 版权声明（如需要）

- 代码注释
  - 遵循苹果官方注释风格
  - 使用 `///` 为公共API添加文档注释
  - 使用 `//` 为实现细节添加行内注释
  - 为复杂逻辑添加详细说明
  - 注释应该解释"为什么"而不是"是什么"
  - 保持注释的及时更新

- 注释示例
```swift
/// 计划管理器负责处理所有计划相关的操作
/// 包括创建、更新、删除和查询计划
///
/// - Important: 所有对计划的修改都必须通过这个类进行
/// - Note: 这个类是线程安全的
class PlanManager {
    // 当前正在执行的计划列表
    private var activePlans: [Plan]
    
    /// 创建新的计划
    /// - Parameters:
    ///   - name: 计划名称
    ///   - startDate: 开始时间
    /// - Returns: 新创建的计划对象
    /// - Throws: PlanError 如果创建失败
    func createPlan(name: String, startDate: Date) throws -> Plan {
        // 实现细节
    }
}
```

## 注意事项

### 避免的做法
1. 直接修改现有功能
2. 不查看相关代码就改动
3. 忽略接口兼容性
4. 跳过测试验证

### 推荐的做法
1. 使用扩展机制
2. 充分了解上下文
3. 保持接口稳定
4. 完整的测试覆盖

## 代码审查重点

### 功能性检查
- 功能完整性
- 边界条件处理
- 错误处理机制
- 性能影响评估

### 质量保证
- 代码可读性
- 维护性考虑
- 测试覆盖率
- 文档完整性

### 安全性检查
- 数据验证
- 访问控制
- 安全漏洞
- 日志记录

## 总结
遵循这些原则可以帮助我们：
1. 保持代码库的稳定性
2. 提高代码质量
3. 减少引入bug的风险
4. 提升开发效率 