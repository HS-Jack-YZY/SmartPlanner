# SmartPlanner V1.0 第一轮迭代需求

## 1. 用户需求场景
### 1.1 计划区间管理
- 用户可以创建计划区间模版
  - 设置区间名称
- 用户可以将计划区间模版拖拽到日历视图中生成计划区间实例
  - 支持拖拽交互
  - 显示区间时间范围
  - 可视化区间边界

### 1.2 计划模版创建
- 用户可以创建新计划模版，包含以下属性：
  - 计划名称（必填）
  - 提醒设置（可选）
    - 开启/关闭提醒
    - 提醒时间点
  - 其他属性（可选）
    - 优先级（1-5）
    - 难度（1-5）
    - 类别

### 1.3 计划分配
- 用户可以将计划模版拖拽到计划区间内生成计划实例
  - 支持拖拽交互
  - 显示计划时间段
  - 计划与区间的视觉关联

## 2. 开发步骤建议

### 第一阶段：基础架构搭建（1周）

#### 1. 项目初始化（0.5天）
##### 1.1 创建项目
- 使用Xcode创建新项目
  - 选择App模板
  - 设置项目名称：SmartPlanner
  - 选择开发语言：Swift
  - 选择界面框架：SwiftUI
  - 设置最低支持版本：iOS 15.0

##### 1.2 版本控制设置
- 初始化Git仓库
- 创建.gitignore文件
- 设置首次提交

#### 2. 项目结构搭建（0.5天）
##### 2.1 目录结构设计及职责

###### Models目录（数据模型层）
- 职责：定义和管理所有数据结构和业务模型
- 计划区间(PlanningZone)模型
  - 区间名称
  - 开始和结束时间
  - 包含的计划列表
  - 区间状态管理
- 计划(Plan)模型
  - 计划名称
  - 开始和结束时间
  - 重复设置
  - 提醒设置
  - 所属区间关系
- 枚举类型定义
  - 计划重复类型(无重复/每天/每周/每月)
  - 提醒类型(开启/关闭)
  - 区间和计划状态
- 数据模型扩展
  - 计划时间计算方法
  - 区间时间范围验证
  - 计划与区间关系管理

###### Views目录（视图层）
- 职责：实现所有用户界面组件
- 日历相关视图
  - 实现日历主视图
  - 实现时间轴组件
  - 实现日期选择器
  - 处理日历交互
- 计划相关视图
  - 实现计划区间视图
  - 实现计划项视图
  - 实现计划编辑表单
- 通用组件视图
  - 自定义按钮
  - 自定义输入框
  - 通用对话框
  - 加载指示器

###### ViewModels目录（视图模型层）
- 职责：处理视图的业务逻辑和状态管理
- 日历视图模型
  - 管理日历数据
  - 处理日期选择逻辑
  - 管理日历展示状态
- 计划视图模型
  - 管理计划数据
  - 处理计划操作逻辑
  - 管理计划状态

###### Services目录（服务层）
- 职责：提供各种业务服务和功能支持
- 数据管理服务
  - 处理CoreData操作
  - 管理数据持久化
  - 处理数据同步
  - 提供CRUD接口
- 通知管理服务
  - 处理本地通知
  - 管理通知权限
  - 处理通知响应
  - 管理通知调度

###### Utilities目录（工具层）
- 职责：提供通用工具和辅助功能
- 扩展方法
  - Date类扩展（日期处理）
  - Color类扩展（颜色处理）
  - String类扩展（字符串处理）
  - View类扩展（视图辅助方法）
- 常量定义
  - UI常量（间距、大小等）
  - 配置常量
  - 错误信息常量
  - ��知名称常量

#### 3. CoreData模型设计（2天）
##### 3.1 数据模型文件创建
- 创建CoreData Model文件
- 设计实体关系图
- 生成实体类文件

##### 3.2 实体设计
###### PlanningZone实体
- 基本信息字段设计
- 显示属性字段设计
- 关联关系设计
- 索引设计

###### Plan实体
- 基本信息字段设计
- 重复设置字段设计
- 提醒设置字段设计
- 关联关系设计
- 索引设计

#### 4. 基础服务实现（2天）
##### 4.1 数据管理服务
- 设计数据管理单例类
- 实现数据持久化方法
- 实现数据查询方法
- 实现数据更新方法
- 实现数据删除方法
- 错误处理机制设计

##### 4.2 通知管理服务
- 通知权限管理
- 本地通知设置
- 通知响应处理
- 通知更新机制

#### 5. 工具类开发（1天）
##### 5.1 日期工具
- 日期格式化方法
- 时间计算方法
- 日期比较方法
- 周期日期生成方法

##### 5.2 颜色工具
- 主题色定义
- 动态颜色适配
- 颜色转换方法

##### 5.3 常量定义
- 界面布局常量
- 时间相关常量
- 错误信息常量
- 通知名称常量

#### 6. 基础UI框架搭建（1天）
##### 6.1 主界面结构设计
- 标签页布局设计
- 导航栈设计
- 视图切换逻辑
- 状态管理设计

##### 6.2 视图模型设计
- 数据流设计
- 状态管理设计
- 业务逻辑封装
- 错误处理设计

#### 7. 开发规范制定
##### 7.1 代码规范
- 命名规范
- 注释规范
- 文件组织规范
- 代码格式规范

##### 7.2 Git工作流规范
- 分支管理策略
- 提交信息规范
- 代码审查流程
- 合并策略

#### 8. 第一阶段完成检查项
- [ ] 项目基础框架搭建完成
- [ ] CoreData模型设计完成并可用
- [ ] 基础服务功能测试通过
- [ ] 工具类开发完成并测试通过
- [ ] 基础UI框架可运行
- [ ] Git仓库配置完成
- [ ] 开发规范文档完成

#### 9. 注意事项
- 确保数据模型的可扩展性
- 注意性能优化
- 保持代码简洁清晰
- 完善错误处理机制
- 做好版本控制
- 编写单元测试

### 第二阶段：日历视图开发（1周）
1. 实现日历基础视图
   - 时间轴显示
   - 日期切换
   - 网格布局
2. 开发拖拽系统
   - 拖拽手势识别
   - 拖拽目标区域
   - 拖拽动画效果

### 第三阶段：计划管理功能（1周）
1. 计划区间功能
   - 区间创建界面
   - 区间数据管理
   - 区间拖拽交互
2. 计划创建功能
   - 创建表单界面
   - 表单数据验证
   - 数据持久化

### 第四阶段：整合与优化（1周）
1. 功能整合
   - 计划拖拽到区间
   - 数据同步机制
   - 界面状态管理
2. 测试与优化
   - 功能测试
   - 性能优化
   - Bug修复

## 3. 技术要点

### 3.1 核心组件
- 日历视图组件（CalendarView）
- 计划区间组件（PlanningZoneView）
- 计划创建表单（PlanCreationForm）
- 拖拽管理器（DragDropManager）

### 3.2 数据模型
- Task（任务模型）
  - 基本属性：id, 标题, 描述, 截止日期
  - 状态属性：优先级, 完成状态
  - 关联关系：标签, 提醒

### 3.3 关键功能
- SwiftUI拖拽系统实现
- CoreData数据管理
- 状态处理工具
- 状态管理系统

## 4. 注意事项
1. 优先实现核心交互流程
2. 确保拖拽体验流畅
3. 注意数据一致性
4. 保持代码可扩展性

#### CoreData数据模型详细设计

##### 1. Category（类别）实体
###### 基础属性
- id: UUID (主键)
- name: String (类别名称)
- color: String? (类别颜色，可选)
- parentId: UUID? (父类别ID，可选)
- level: Int (层级深度，0表示顶级)
- path: String? (完整类别路径，可选)
- isVisible: Bool (是否显示)
- displayOrder: Int? (显示顺序，可选)
- createdAt: Date (创建时间)
- updatedAt: Date (更新时间)
- deletedAt: Date? (删除时间，可选)

##### 2. PlanBlockTemplate（计划区间模板）实体
###### 基础属性
- id: UUID (主键)
- name: String (区间名称)
- color: String? (区间颜色，可选)
- desc: String? (区间描述，可选)
- isVisible: Bool (是否在日历中显示)
- createdAt: Date (创建时间)
- updatedAt: Date (更新时间)
- deletedAt: Date? (删除时间，可选)

##### 3. PlanBlockInstance（计划区间实例）实体
###### 基础属性
- id: UUID (主键)
- startAt: Date (开始时间)
- endAt: Date (结束时间)
- createdAt: Date (创建时间)
- updatedAt: Date (更新时间)
- deletedAt: Date? (删除时间，可选)

##### 4. PlanTemplate（计划模板）实体
###### 基础属性
- id: UUID (主键)
- name: String (计划名称)
- color: String? (显示颜色，可选)
- isFixedTime: Bool (是否固定时间)
- isReminderEnabled: Bool (是否启用提醒)
- reminderTime: Int? (提前提醒分钟数，可选)
- priority: Int? (优先级：1-5，可选)
- difficulty: Int? (难度：1-5，可选)
- tags: String? (标签列表，可选)
- createdAt: Date (创建时间)
- updatedAt: Date (更新时间)
- deletedAt: Date? (删除时间，可选)

##### 5. PlanInstance（计划实例）实体
###### 基础属性
- id: UUID (主键)
- startTime: Date (开始时间)
- endTime: Date (结束时间)
- duration: Int (持续时长，分钟)
- isReminderEnabled: Bool (是否启用提醒)
- reminderTime: Int? (提醒时间，可选)
- priority: Int? (优先级：1-5，可选)
- difficulty: Int? (难度：1-5，可选)
- createdAt: Date (创建时间)
- updatedAt: Date (更新时间)
- deletedAt: Date? (删除时间，可选)

##### 6. 数据关系
###### 一对多关系
- Category <-> Category (父子关系)
- Category <-> PlanTemplate (类别-计划模板)
- PlanTemplate <-> PlanInstance (模板-实例)
- PlanBlockTemplate <-> PlanBlockInstance (区间模板-实例)
- PlanBlockInstance <-> PlanInstance (区间实例-计划实例)

###### 删除规则
- 父子关系：父实体删除时级联删除子实体（Cascade）
- 引用关系：被引用实体删除时清空引用（Nullify）

###### 数据完整性
- 删除模板时不删除已创建的实例
- 更新区间时间范围时验证所包含Plan的时间有效性